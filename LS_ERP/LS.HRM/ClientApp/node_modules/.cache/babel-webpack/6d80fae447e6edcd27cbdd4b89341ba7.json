{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../../services/notification.service\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@ngx-translate/core\";\n\nfunction PostingadvancepaymentComponent_div_42_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵelementStart(1, \"div\", 3);\n    i0.ɵɵelementStart(2, \"label\", 4);\n    i0.ɵɵtext(3);\n    i0.ɵɵpipe(4, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_div_42_Template_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return ctx_r1.remainingAdvAmount = $event;\n    })(\"keyup\", function PostingadvancepaymentComponent_div_42_Template_input_keyup_5_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return ctx_r3.totalArAmtCal();\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(4, 2, \"Remaining_Advance_Amount_Payable\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.remainingAdvAmount);\n  }\n}\n\nexport let PostingadvancepaymentComponent = /*#__PURE__*/(() => {\n  class PostingadvancepaymentComponent {\n    constructor(notifyService, dialogRef) {\n      this.notifyService = notifyService;\n      this.dialogRef = dialogRef;\n      this.arVoucherAmt = 0;\n      this.discountAmt = 0;\n      this.netAmt = 0;\n      this.writeOffAmt = 0;\n      this.paidAmt = 0;\n      this.minCutOffShortAmt = 0;\n      this.maxCutOffOverAmr = 0;\n      this.advAmount = 0;\n      this.remainingAdvAmount = 0;\n      this.hasDiscount = false;\n      this.paidAmtReadOnly = false;\n    }\n\n    ngOnInit() {\n      if (this.data) {\n        this.arVoucherAmt = this.data.arAmount;\n        this.netAmt = this.arVoucherAmt;\n        console.log(this.data);\n        this.minCutOffShortAmt = this.data.fin.minCutOffShortAmt;\n        this.maxCutOffOverAmr = this.data.fin.maxCutOffOverAmr;\n        this.advAmount = this.data.fin.advAmount;\n\n        if (this.advAmount > 0) {\n          this.paidAmtReadOnly = true;\n          this.writeOffAmt = 0;\n          if (this.advAmount >= this.arVoucherAmt) this.paidAmt = this.arVoucherAmt;else {\n            this.paidAmt = parseFloat((this.arVoucherAmt - this.advAmount).toFixed(2)); // this.paidAmtReadOnly = false;\n          }\n          this.remainingAdvAmount = parseFloat((this.advAmount - this.arVoucherAmt).toFixed(2));\n        }\n      } else this.dialogRef.close({\n        hasData: 0\n      });\n    }\n\n    calculateDis() {\n      this.netAmt = parseFloat((this.data.arAmount - this.discountAmt).toFixed(2));\n      this.writeOffAmt = 0;\n      this.hasDiscount = this.discountAmt != 0;\n    }\n\n    totalArAmtCal() {\n      if (this.paidAmt > 0 && !this.hasDiscount && !this.paidAmtReadOnly) {\n        this.writeOffAmt = parseFloat((this.paidAmt - this.netAmt).toFixed(2));\n      }\n    }\n\n    postAdvanceAmt() {\n      this.totalArAmtCal(); //console.log(this.writeOffAmt, this.minCutOffShortAmt, this.maxCutOffOverAmr);\n\n      let response = {\n        hasData: 1,\n        paidAmount: this.paidAmt,\n        source: 'ar',\n        advanceAmount: 0,\n        remainingAdvAmount: this.remainingAdvAmount\n      };\n\n      if (this.writeOffAmt != 0 && !this.hasDiscount) {\n        if (this.writeOffAmt > this.maxCutOffOverAmr) {\n          //advance payment\n          // response.advanceAmount = this.writeOffAmt;\n          response.amountType = 'advance'; //  this.notifyService.showSuccess('advance amt');\n          // this.dialogRef.close(response);\n\n          this.notifyService.showError(`writeOff Amount range should be min : ${this.minCutOffShortAmt} and max : ${this.maxCutOffOverAmr} `); //\n          //this.notifyService.showError('No Advance Payment');\n        } else if (this.writeOffAmt >= this.minCutOffShortAmt && this.writeOffAmt <= this.maxCutOffOverAmr) {\n          response.writeOffAmount = this.writeOffAmt;\n\n          if (this.writeOffAmt < 0) {\n            // for short payment\n            response.amountType = 'short';\n            response.writeOffAmount = -1 * this.writeOffAmt; //  this.notifyService.showSuccess('short amt');\n          } else {\n            //for over payment\n            response.amountType = 'over'; //  this.notifyService.showSuccess('over amt');\n          }\n\n          this.dialogRef.close(response);\n        } else {\n          this.notifyService.showError(`writeOff Amount range should be min : ${this.minCutOffShortAmt} and max : ${this.maxCutOffOverAmr} `); //\n        }\n      } else {\n        response.writeOffAmount = 0;\n\n        if (this.paidAmt >= this.netAmt) {\n          //advance payment\n          if (this.paidAmt > this.netAmt) {\n            //advance payment\n            //can submit the data\n            // response.advanceAmount = parseFloat((this.paidAmt - this.netAmt).toFixed(2));\n            response.amountType = 'advance'; //  this.notifyService.showSuccess('advance amt');\n            // this.notifyService.showError('No Advance Payment');\n\n            this.notifyService.showError(`writeOff Amount range should be min : ${this.minCutOffShortAmt} and max : ${this.maxCutOffOverAmr} `); //\n          } else {\n            response.amountType = 'equal'; // this.notifyService.showSuccess('equal amt');\n\n            this.dialogRef.close(response);\n          }\n        } else if (this.paidAmtReadOnly) this.dialogRef.close(response);else this.notifyService.showError('amount should be >= ' + this.netAmt);\n      }\n    }\n\n    closeModel() {\n      this.dialogRef.close({\n        hasData: -1\n      });\n    }\n\n  }\n\n  PostingadvancepaymentComponent.ɵfac = function PostingadvancepaymentComponent_Factory(t) {\n    return new (t || PostingadvancepaymentComponent)(i0.ɵɵdirectiveInject(i1.NotificationService), i0.ɵɵdirectiveInject(i2.MatDialogRef));\n  };\n\n  PostingadvancepaymentComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PostingadvancepaymentComponent,\n    selectors: [[\"app-postingadvancepayment\"]],\n    decls: 52,\n    vars: 35,\n    consts: [[\"type\", \"button\", \"aria-hidden\", \"true\", 1, \"close\", 3, \"click\"], [1, \"row\", \"rowm0\"], [1, \"col-md-12\", \"col-lg-12\"], [1, \"form-group\"], [1, \"mr-sm-2\"], [\"type\", \"number\", \"readonly\", \"readonly\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"col-md-12\", \"col-lg-12\", \"d-none\"], [\"type\", \"number\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\", \"keyup\"], [\"type\", \"number\", 1, \"form-control\", 3, \"ngModel\", \"readonly\", \"ngModelChange\", \"keyup\"], [\"class\", \"col-md-12 col-lg-12\", 4, \"ngIf\"], [1, \"row\"], [1, \"col-lg-12\", \"col-md-12\", \"text-center\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"waves-effect\", \"waves-light\", \"btn-primary\", 3, \"click\"], [\"type\", \"number\", \"readonly\", \"readonly\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\", \"keyup\"]],\n    template: function PostingadvancepaymentComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h3\");\n        i0.ɵɵtext(1);\n        i0.ɵɵpipe(2, \"translate\");\n        i0.ɵɵelementStart(3, \"button\", 0);\n        i0.ɵɵlistener(\"click\", function PostingadvancepaymentComponent_Template_button_click_3_listener() {\n          return ctx.closeModel();\n        });\n        i0.ɵɵtext(4, \" \\u00D7\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 1);\n        i0.ɵɵelementStart(6, \"div\", 2);\n        i0.ɵɵelementStart(7, \"div\", 3);\n        i0.ɵɵelementStart(8, \"label\", 4);\n        i0.ɵɵtext(9);\n        i0.ɵɵpipe(10, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"input\", 5);\n        i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_Template_input_ngModelChange_11_listener($event) {\n          return ctx.arVoucherAmt = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"div\", 6);\n        i0.ɵɵelementStart(13, \"div\", 3);\n        i0.ɵɵelementStart(14, \"label\", 4);\n        i0.ɵɵtext(15);\n        i0.ɵɵpipe(16, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"input\", 7);\n        i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_Template_input_ngModelChange_17_listener($event) {\n          return ctx.discountAmt = $event;\n        })(\"keyup\", function PostingadvancepaymentComponent_Template_input_keyup_17_listener() {\n          return ctx.calculateDis();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"div\", 2);\n        i0.ɵɵelementStart(19, \"div\", 3);\n        i0.ɵɵelementStart(20, \"label\", 4);\n        i0.ɵɵtext(21);\n        i0.ɵɵpipe(22, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"input\", 5);\n        i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_Template_input_ngModelChange_23_listener($event) {\n          return ctx.advAmount = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"div\", 2);\n        i0.ɵɵelementStart(25, \"div\", 3);\n        i0.ɵɵelementStart(26, \"label\", 4);\n        i0.ɵɵtext(27);\n        i0.ɵɵpipe(28, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"input\", 5);\n        i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_Template_input_ngModelChange_29_listener($event) {\n          return ctx.netAmt = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"div\", 2);\n        i0.ɵɵelementStart(31, \"div\", 3);\n        i0.ɵɵelementStart(32, \"label\", 4);\n        i0.ɵɵtext(33);\n        i0.ɵɵpipe(34, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(35, \"input\", 5);\n        i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_Template_input_ngModelChange_35_listener($event) {\n          return ctx.writeOffAmt = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"div\", 2);\n        i0.ɵɵelementStart(37, \"div\", 3);\n        i0.ɵɵelementStart(38, \"label\", 4);\n        i0.ɵɵtext(39);\n        i0.ɵɵpipe(40, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(41, \"input\", 8);\n        i0.ɵɵlistener(\"ngModelChange\", function PostingadvancepaymentComponent_Template_input_ngModelChange_41_listener($event) {\n          return ctx.paidAmt = $event;\n        })(\"keyup\", function PostingadvancepaymentComponent_Template_input_keyup_41_listener() {\n          return ctx.totalArAmtCal();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(42, PostingadvancepaymentComponent_div_42_Template, 6, 4, \"div\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(43, \"div\", 10);\n        i0.ɵɵelementStart(44, \"div\", 11);\n        i0.ɵɵelementStart(45, \"button\", 12);\n        i0.ɵɵlistener(\"click\", function PostingadvancepaymentComponent_Template_button_click_45_listener() {\n          return ctx.closeModel();\n        });\n        i0.ɵɵtext(46);\n        i0.ɵɵpipe(47, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(48, \" \\u00A0\\u00A0 \");\n        i0.ɵɵelementStart(49, \"button\", 13);\n        i0.ɵɵlistener(\"click\", function PostingadvancepaymentComponent_Template_button_click_49_listener() {\n          return ctx.postAdvanceAmt();\n        });\n        i0.ɵɵtext(50);\n        i0.ɵɵpipe(51, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 17, \"Posting_Advance_Payment\"), \" \");\n        i0.ɵɵadvance(8);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(10, 19, \"Total_Ar_Voucher_Amount\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.arVoucherAmt);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(16, 21, \"Appy_DiscountAmount_Payment\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.discountAmt);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(22, 23, \"Advance_Amount_Payable\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.advAmount);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(28, 25, \"Net_Amount_Payable\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.netAmt);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(34, 27, \"Write_Off_Amount\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.writeOffAmt);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(40, 29, \"Amount_paid\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.paidAmt)(\"readonly\", ctx.paidAmtReadOnly);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.remainingAdvAmount >= 0);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(47, 31, \"Cancel\"), \" \");\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(51, 33, \"Save\"));\n      }\n    },\n    directives: [i3.NumberValueAccessor, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, i4.NgIf],\n    pipes: [i5.TranslatePipe],\n    encapsulation: 2\n  });\n  return PostingadvancepaymentComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}
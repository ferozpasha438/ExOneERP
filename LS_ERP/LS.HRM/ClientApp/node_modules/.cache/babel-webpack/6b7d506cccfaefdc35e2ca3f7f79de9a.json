{"ast":null,"code":"import { ParentSalesMgtComponent } from '../../../sharedcomponent/parentsalesmgt.component';\nimport { ItemstockavailabilitylistPopupComponent } from '../../snd-quotations/addupdatesndquotation/itemstockavailabilitylist-popup/itemstockavailabilitylist-popup.component';\nimport { QuotationstockavailabilityPopupComponent } from '../../snd-quotations/addupdatesndquotation/quotationstockavailability-popup/quotationstockavailability-popup.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../snd-services.service\";\nimport * as i2 from \"@ngx-translate/core\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/common/http\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"../../../services/api.service\";\nimport * as i7 from \"../../../api-authorization/AuthorizeService\";\nimport * as i8 from \"../../../services/utility.service\";\nimport * as i9 from \"@angular/material/dialog\";\nimport * as i10 from \"../../../services/notification.service\";\nimport * as i11 from \"../../../sharedcomponent/ValidationService\";\nimport * as i12 from \"../../../services/common.service\";\nimport * as i13 from \"@angular/common\";\nimport * as i14 from \"@angular/material/tooltip\";\n\nfunction EditdeliverynoteComponent_tr_32_td_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r1 == null ? null : item_r1.delivery);\n  }\n}\n\nconst _c0 = function () {\n  return {\n    standalone: true\n  };\n};\n\nfunction EditdeliverynoteComponent_tr_32_td_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"td\");\n    i0.ɵɵelementStart(1, \"input\", 9);\n    i0.ɵɵlistener(\"ngModelChange\", function EditdeliverynoteComponent_tr_32_td_10_Template_input_ngModelChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.editingItem.delivery = $event;\n    })(\"change\", function EditdeliverynoteComponent_tr_32_td_10_Template_input_change_1_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const i_r2 = i0.ɵɵnextContext().index;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.changeDeliveryQuantity(i_r2);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngModel\", ctx_r4.editingItem.delivery)(\"ngModelOptions\", i0.ɵɵpureFunction0(2, _c0));\n  }\n}\n\nfunction EditdeliverynoteComponent_tr_32_span_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelementStart(1, \"i\", 10);\n    i0.ɵɵlistener(\"click\", function EditdeliverynoteComponent_tr_32_span_19_Template_i_click_1_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const i_r2 = i0.ɵɵnextContext().index;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.editDeliveryNoteItem(i_r2);\n    });\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" \\u00A0 \");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"matTooltip\", i0.ɵɵpipeBind1(2, 1, \"Edit\"));\n  }\n}\n\nfunction EditdeliverynoteComponent_tr_32_span_20_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelementStart(1, \"i\", 11);\n    i0.ɵɵlistener(\"click\", function EditdeliverynoteComponent_tr_32_span_20_Template_i_click_1_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext(2);\n      return ctx_r15.cancelEditing();\n    });\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" \\u00A0 \");\n    i0.ɵɵelementStart(4, \"i\", 12);\n    i0.ɵɵlistener(\"click\", function EditdeliverynoteComponent_tr_32_span_20_Template_i_click_4_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r17 = i0.ɵɵnextContext(2);\n      return ctx_r17.save();\n    });\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \" \\u00A0 \");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"matTooltip\", i0.ɵɵpipeBind1(2, 2, \"Cancel\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"matTooltip\", i0.ɵɵpipeBind1(5, 4, \"Save\"));\n  }\n}\n\nfunction EditdeliverynoteComponent_tr_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelementStart(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, EditdeliverynoteComponent_tr_32_td_9_Template, 2, 1, \"td\", 6);\n    i0.ɵɵtemplate(10, EditdeliverynoteComponent_tr_32_td_10_Template, 2, 3, \"td\", 6);\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\", 7);\n    i0.ɵɵelementStart(16, \"i\", 8);\n    i0.ɵɵlistener(\"click\", function EditdeliverynoteComponent_tr_32_Template_i_click_16_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r19);\n      const item_r1 = restoredCtx.$implicit;\n      const ctx_r18 = i0.ɵɵnextContext();\n      return ctx_r18.CheckStockAvailability(item_r1);\n    });\n    i0.ɵɵpipe(17, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(18, \" \\u00A0 \");\n    i0.ɵɵtemplate(19, EditdeliverynoteComponent_tr_32_span_19_Template, 4, 3, \"span\", 6);\n    i0.ɵɵtemplate(20, EditdeliverynoteComponent_tr_32_span_20_Template, 7, 6, \"span\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.itemName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.quantity);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.unitType);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editRowNumber != i_r2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editRowNumber == i_r2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.delivered);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r1.backOrder);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"matTooltip\", i0.ɵɵpipeBind1(17, 11, \"Check_Stock_Availability\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editRowNumber != i_r2 && ctx_r0.editRowNumber == -1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.editRowNumber == i_r2);\n  }\n}\n\nexport let EditdeliverynoteComponent = /*#__PURE__*/(() => {\n  class EditdeliverynoteComponent extends ParentSalesMgtComponent {\n    constructor(sndService, translate, fb, http, router, apiService, authService, utilService, dialogRef, notifyService, validationService, commonService, dialog) {\n      super(authService);\n      this.sndService = sndService;\n      this.translate = translate;\n      this.fb = fb;\n      this.http = http;\n      this.router = router;\n      this.apiService = apiService;\n      this.authService = authService;\n      this.utilService = utilService;\n      this.dialogRef = dialogRef;\n      this.notifyService = notifyService;\n      this.validationService = validationService;\n      this.commonService = commonService;\n      this.dialog = dialog;\n      this.id = 0;\n      this.customerList = [];\n      this.companyList = [];\n      this.paymentTermsList = [];\n      this.warehouseList = [];\n      this.itemList = [];\n      this.vatList = [];\n      this.itemId = '';\n      this.quantity = 0;\n      this.unitPrice = 0;\n      this.vat = 0;\n      this.vatAmount = 0;\n      this.total = 0;\n      this.itemInvAmount = 0;\n      this.discount = 0;\n      this.discountAmount = 0;\n      this.unitType = '';\n      this.description = '';\n      this.item = '';\n      this.itemCode = '';\n      this.grandDiscountAmount = 0;\n      this.grandTotal = 0;\n      this.grandFooterDiscountAmount = 0;\n      this.grandVatTotal = 0;\n      this.grandQuotationTotal = 0;\n      this.grandTotalStr = '';\n      this.grandVatTotalStr = '';\n      this.grandQuotationTotalStr = '';\n      this.grandFooterDiscountAmountStr = '';\n      this.footerDiscount = 0;\n      this.footerDiscountAmount = 0;\n      this.sequence = 1;\n      this.editsequence = 0;\n      this.listOfDeliveryNotes = [];\n      this.canShowNotes = false;\n      this.canShowRemarks = false;\n      this.isArab = false;\n      this.delivery = 0;\n      this.unitTypesList = []; // [{ text: \"BOX\", value: \"BOX\" }, { text: \"EACH\", value: \"EACH\" }];\n\n      this.editingItem = {\n        delivery: 0\n      };\n      this.editingInitialDelivery = 0;\n      this.editRowNumber = -1;\n      this.isLoading = false;\n      this.isUpdated = false;\n    }\n\n    ngOnInit() {\n      this.seteditform();\n    }\n\n    seteditform() {\n      this.apiService.get(\"SndDeliveryNote/getSingleSndDeliveryNoteById\", this.id).subscribe(res => {\n        if (res) {\n          this.footerDiscount = res.footerDiscount;\n          this.warehouseCode = res.warehouseCode;\n          this.listOfDeliveryNotes = res.itemList;\n        }\n      });\n    }\n\n    editDeliveryNoteItem(index) {\n      this.editingInitialDelivery = this.listOfDeliveryNotes[index].delivery;\n      this.editingItem = this.listOfDeliveryNotes[index];\n      this.editRowNumber = index;\n    }\n\n    closeModel() {\n      this.dialogRef.close(this.isUpdated);\n    }\n\n    changeDeliveryQuantity(index) {\n      if (this.editingItem.delivery >= 0 && this.editingItem.quantity - this.editingItem.delivery >= 0 && this.editingItem.quantity != null) {\n        this.listOfDeliveryNotes[index].delivery = this.editingItem.delivery;\n        this.listOfDeliveryNotes[index].backOrder = this.editingItem.quantity - this.editingItem.delivery;\n        this.editRowNumber = index;\n      } else {\n        this.editingItem.delivery = 0;\n        this.listOfDeliveryNotes[index].delivery = this.listOfDeliveryNotes[index].quantity;\n        this.listOfDeliveryNotes[index].backOrder = 0;\n      }\n    }\n\n    CheckStockAvailability(item) {\n      let itemCode = item == null ? this.itemCode : item.itemCode;\n      let quantity = item == null ? this.quantity : item.quantity; // may be item.delivery\n\n      let unitType = item == null ? this.unitType : item.unitType;\n\n      if (itemCode != '' && this.warehouseCode && quantity > 0 && unitType != '') {\n        this.openDialogManage2(itemCode, this.warehouseCode, quantity, unitType, ItemstockavailabilitylistPopupComponent);\n      }\n    }\n\n    openDialogManage2(itemCode, WarehouseCode, quantity, unitType, component) {\n      let dialogRef = this.sndService.openAutoWidthDialog(this.dialog, component);\n      dialogRef.componentInstance.itemCode = itemCode;\n      dialogRef.componentInstance.warehouseCode = WarehouseCode;\n      dialogRef.componentInstance.quantity = quantity;\n      dialogRef.componentInstance.unitType = unitType;\n      dialogRef.afterClosed().subscribe(res => {\n        if (res && res === true) {}\n      });\n    }\n\n    checkQuotationStock() {\n      this.form.value['id'] = 0;\n      this.form.value['itemList'] = this.listOfDeliveryNotes.slice(0);\n      let inputData = this.form.value;\n      this.openDialogManage3(inputData, QuotationstockavailabilityPopupComponent);\n    }\n\n    openDialogManage3(inputData, component) {\n      let dialogRef = this.sndService.openAutoWidthDialog(this.dialog, component);\n      dialogRef.componentInstance.inputData = inputData;\n      dialogRef.afterClosed().subscribe(res => {});\n    }\n\n    cancelEditing() {\n      this.listOfDeliveryNotes[this.editRowNumber].delivery = this.editingInitialDelivery;\n      this.listOfDeliveryNotes[this.editRowNumber].backOrder = this.editingItem.quantity - this.editingItem.delivery;\n      this.editRowNumber = -1;\n      this.editingItem = null;\n    }\n\n    save() {\n      if (!this.isLoading) {\n        if (this.editRowNumber != -1) {\n          let input = this.listOfDeliveryNotes[this.editRowNumber];\n          this.isLoading = true;\n          this.apiService.post('SndDeliveryNote/updateSndDeliveryNoteLineDeliveryQty', input).subscribe(res => {\n            this.utilService.OkMessage();\n            this.seteditform();\n            this.editRowNumber = -1;\n            this.isLoading = false;\n            this.isUpdated = true;\n          }, error => {\n            console.error(error);\n            this.utilService.ShowApiErrorMessage(error);\n            this.isLoading = false;\n          });\n        }\n      }\n    }\n\n  }\n\n  EditdeliverynoteComponent.ɵfac = function EditdeliverynoteComponent_Factory(t) {\n    return new (t || EditdeliverynoteComponent)(i0.ɵɵdirectiveInject(i1.SndServicesService), i0.ɵɵdirectiveInject(i2.TranslateService), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.HttpClient), i0.ɵɵdirectiveInject(i5.Router), i0.ɵɵdirectiveInject(i6.ApiService), i0.ɵɵdirectiveInject(i7.AuthorizeService), i0.ɵɵdirectiveInject(i8.UtilityService), i0.ɵɵdirectiveInject(i9.MatDialogRef), i0.ɵɵdirectiveInject(i10.NotificationService), i0.ɵɵdirectiveInject(i11.ValidationService), i0.ɵɵdirectiveInject(i12.CommonService), i0.ɵɵdirectiveInject(i9.MatDialog));\n  };\n\n  EditdeliverynoteComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditdeliverynoteComponent,\n    selectors: [[\"app-editdeliverynote\"]],\n    features: [i0.ɵɵInheritDefinitionFeature],\n    decls: 33,\n    vars: 23,\n    consts: [[\"type\", \"button\", \"aria-hidden\", \"true\", 1, \"close\", 3, \"click\"], [1, \"row\", \"rowm0\"], [1, \"table-responsive\"], [\"id\", \"zero_config\", 1, \"table\", \"table-bordered\", \"no-wrap\"], [1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"text-center\", 2, \"font-size\", \"larger\"], [1, \"icon-question\", 3, \"matTooltip\", \"click\"], [\"type\", \"number\", 3, \"ngModel\", \"ngModelOptions\", \"ngModelChange\", \"change\"], [1, \"icon-note\", \"cpointer\", 3, \"matTooltip\", \"click\"], [1, \"fas\", \"fa-window-close\", 3, \"matTooltip\", \"click\"], [1, \"fas\", \"fa-save\", 3, \"matTooltip\", \"click\"]],\n    template: function EditdeliverynoteComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h3\");\n        i0.ɵɵtext(1);\n        i0.ɵɵelementStart(2, \"button\", 0);\n        i0.ɵɵlistener(\"click\", function EditdeliverynoteComponent_Template_button_click_2_listener() {\n          return ctx.closeModel();\n        });\n        i0.ɵɵtext(3, \" \\u00D7\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 1);\n        i0.ɵɵelementStart(5, \"div\", 2);\n        i0.ɵɵelementStart(6, \"table\", 3);\n        i0.ɵɵelementStart(7, \"thead\");\n        i0.ɵɵelementStart(8, \"tr\");\n        i0.ɵɵelementStart(9, \"th\");\n        i0.ɵɵtext(10);\n        i0.ɵɵpipe(11, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"th\");\n        i0.ɵɵtext(13);\n        i0.ɵɵpipe(14, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"th\");\n        i0.ɵɵtext(16);\n        i0.ɵɵpipe(17, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"th\");\n        i0.ɵɵtext(19);\n        i0.ɵɵpipe(20, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"th\");\n        i0.ɵɵtext(22);\n        i0.ɵɵpipe(23, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"th\");\n        i0.ɵɵtext(25);\n        i0.ɵɵpipe(26, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"th\");\n        i0.ɵɵtext(28);\n        i0.ɵɵpipe(29, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(30, \"th\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(31, \"tbody\");\n        i0.ɵɵtemplate(32, EditdeliverynoteComponent_tr_32_Template, 21, 13, \"tr\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", ctx.modalTitle, \" \");\n        i0.ɵɵadvance(9);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(11, 9, \"Item\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(14, 11, \"Description\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(17, 13, \"Quantity\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(20, 15, \"Unit\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(23, 17, \"Delivery\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(26, 19, \"Delivered\"));\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(29, 21, \"Back_Order\"));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.listOfDeliveryNotes);\n      }\n    },\n    directives: [i13.NgForOf, i13.NgIf, i14.MatTooltip, i3.NumberValueAccessor, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel],\n    pipes: [i2.TranslatePipe],\n    encapsulation: 2\n  });\n  return EditdeliverynoteComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}